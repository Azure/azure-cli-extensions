# --------------------------------------------------------------------------
# Copyright (c) Microsoft Corporation. All rights reserved.
# Licensed under the MIT License. See License.txt in the project root for
# license information.
#
# Code generated by Microsoft (R) AutoRest Code Generator.
# Changes may cause incorrect behavior and will be lost if the code is
# regenerated.
# --------------------------------------------------------------------------
import pytest
import yaml
from azext_mlv2.tests.scenario_test_helper import MLBaseScenarioTest


@pytest.mark.skip(reason="TODO: CannotOverwriteExistingCassetteException")
class DataImportScenarioTest(MLBaseScenarioTest):
    def test_data_import(self) -> None:
        # data import
        data_import_job = self.cmd(
            "az ml data import --name my_asset --file ./src/cli/src/machinelearningservices/azext_mlv2/tests/test_configs/data_import/data_import.yaml"
        )
        data_import_job_obj = yaml.safe_load(data_import_job.output)

        job = data_import_job_obj["jobs"]["data_import_my_asset"]
        assert job["outputs"]["sink"]["name"] == "my_asset"
        assert job["outputs"]["sink"]["path"] == "azureml://datastores/workspaceblobstore/paths/{name}"

        assert data_import_job_obj["jobs"]["data_import_my_asset"]["source"]["type"] == "database"
        assert data_import_job_obj["jobs"]["data_import_my_asset"]["source"]["query"] == "select * from region"
        assert data_import_job_obj["jobs"]["data_import_my_asset"]["source"]["connection"] == "azureml:my_azuresqldb_connection"

        # data list-materialization-status
        data_import_jobs = self.cmd(
            "az ml data list-materialization-status --name my_asset"
        )
        data_import_jobs_obj = yaml.safe_load(data_import_jobs.output)
