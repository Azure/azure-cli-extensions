# --------------------------------------------------------------------------
# Copyright (c) Microsoft Corporation. All rights reserved.
# Licensed under the MIT License. See License.txt in the project root for
# license information.
#
# Code generated by Microsoft (R) AutoRest Code Generator.
# Changes may cause incorrect behavior and will be lost if the code is
# regenerated.
# --------------------------------------------------------------------------

import os
from azure.cli.testsdk import ScenarioTest
from .. import try_manual, raise_if, calc_coverage
from azure.cli.testsdk import ResourceGroupPreparer


TEST_DIR = os.path.abspath(os.path.join(os.path.abspath(__file__), '..'))


# Env setup
@try_manual
def setup(test, rg_2, rg):
    pass


# EXAMPLE: /ManagementAssociations/put/SolutionCreate
@try_manual
def step__managementassociations_put_solutioncreate(test, rg_2, rg):
    test.cmd('az operationsmanagement management-association create '
             '--name "{myManagementAssociation}" '
             '--location "East US" '
             '--application-id "/subscriptions/{subscription_id}/resourcegroups/{rg}/providers/Microsoft.Appliance/Appl'
             'iances/appliance1" '
             '--provider-name "providerName" '
             '--resource-group "{rg}" '
             '--resource-name "resourceName" '
             '--resource-type "resourceType"',
             checks=[
                 test.check("name", "{myManagementAssociation}", case_sensitive=False),
                 test.check("location", "East US", case_sensitive=False),
                 test.check("applicationId", "/subscriptions/{subscription_id}/resourcegroups/{rg}/providers/Microsoft."
                            "Appliance/Appliances/appliance1", case_sensitive=False),
             ])


# EXAMPLE: /ManagementAssociations/get/SolutionGet
@try_manual
def step__managementassociations_get_solutionget(test, rg_2, rg):
    test.cmd('az operationsmanagement management-association show '
             '--name "{myManagementAssociation}" '
             '--provider-name "providerName" '
             '--resource-group "{rg}" '
             '--resource-name "resourceName" '
             '--resource-type "resourceType"',
             checks=[
                 test.check("name", "{myManagementAssociation}", case_sensitive=False),
                 test.check("location", "East US", case_sensitive=False),
                 test.check("applicationId", "/subscriptions/{subscription_id}/resourcegroups/{rg}/providers/Microsoft."
                            "Appliance/Appliances/appliance1", case_sensitive=False),
             ])


# EXAMPLE: /ManagementAssociations/get/SolutionList
@try_manual
def step__managementassociations_get_solutionlist(test, rg_2, rg):
    test.cmd('az operationsmanagement management-association list',
             checks=[
                 test.check('length(@)', 1),
             ])


# EXAMPLE: /ManagementAssociations/delete/SolutionDelete
@try_manual
def step__managementassociations_delete_solutiondelete(test, rg_2, rg):
    test.cmd('az operationsmanagement management-association delete -y '
             '--name "{myManagementAssociation2}" '
             '--provider-name "providerName" '
             '--resource-group "{rg}" '
             '--resource-name "resourceName" '
             '--resource-type "resourceType"',
             checks=[])


# EXAMPLE: /ManagementConfigurations/put/ManagementConfigurationCreate
@try_manual
def step__managementconfigurations_put(test, rg_2, rg):
    test.cmd('az operationsmanagement management-configuration create '
             '--name "{myManagementConfiguration2}" '
             '--properties-parameters location="East US" '
             '--resource-group "{rg}"',
             checks=[
                 test.check("name", "{myManagementConfiguration2}", case_sensitive=False),
             ])


# EXAMPLE: /ManagementConfigurations/get/SolutionGet
@try_manual
def step__managementconfigurations_get_solutionget(test, rg_2, rg):
    test.cmd('az operationsmanagement management-configuration show '
             '--name "{myManagementConfiguration}" '
             '--resource-group "{rg}"',
             checks=[])


# EXAMPLE: /ManagementConfigurations/get/SolutionList
@try_manual
def step__managementconfigurations_get_solutionlist(test, rg_2, rg):
    test.cmd('az operationsmanagement management-configuration list',
             checks=[
                 test.check('length(@)', 1),
             ])


# EXAMPLE: /ManagementConfigurations/delete/ManagementConfigurationDelete
@try_manual
def step__managementconfigurations_delete(test, rg_2, rg):
    test.cmd('az operationsmanagement management-configuration delete -y '
             '--name "{myManagementConfiguration}" '
             '--resource-group "{rg}"',
             checks=[])


# EXAMPLE: /Solutions/put/SolutionCreate
@try_manual
def step__solutions_put_solutioncreate(test, rg_2, rg):
    test.cmd('az operationsmanagement solution create '
             '--location "East US" '
             '--plan name="name1" product="product1" promotion-code="promocode1" publisher="publisher1" '
             '--properties contained-resources="/subscriptions/{subscription_id}/resourceGroups/{rg_2}/providers/provid'
             'er1/resources/resource1" contained-resources="/subscriptions/{subscription_id}/resourceGroups/{rg_2}/prov'
             'iders/provider2/resources/resource2" referenced-resources="/subscriptions/{subscription_id}/resourceGroup'
             's/{rg_2}/providers/provider1/resources/resource2" referenced-resources="/subscriptions/{subscription_id}/'
             'resourceGroups/{rg_2}/providers/provider2/resources/resource3" workspace-resource-id="/subscriptions/{sub'
             'scription_id}/resourceGroups/{rg_2}/providers/Microsoft.OperationalInsights/workspaces/ws1" '
             '--resource-group "{rg}" '
             '--name "{mySolution}"',
             checks=[])


# EXAMPLE: /Solutions/get/SolutionGet
@try_manual
def step__solutions_get_solutionget(test, rg_2, rg):
    test.cmd('az operationsmanagement solution show '
             '--resource-group "{rg}" '
             '--name "{mySolution}"',
             checks=[
                 test.check("location", "East US", case_sensitive=False),
                 test.check("plan.name", "name1", case_sensitive=False),
                 test.check("plan.product", "product1", case_sensitive=False),
                 test.check("plan.promotionCode", "promocode1", case_sensitive=False),
                 test.check("plan.publisher", "publisher1", case_sensitive=False),
                 test.check("name", "{mySolution}", case_sensitive=False),
             ])


# EXAMPLE: /Solutions/get/SolutionList
@try_manual
def step__solutions_get_solutionlist(test, rg_2, rg):
    test.cmd('az operationsmanagement solution list '
             '--resource-group "{rg}"',
             checks=[
                 test.check('length(@)', 1),
             ])


# EXAMPLE: /Solutions/get/SolutionList
@try_manual
def step__solutions_get_solutionlist(test, rg_2, rg):
    test.cmd('az operationsmanagement solution list '
             '--resource-group "{rg}"',
             checks=[
                 test.check('length(@)', 1),
             ])


# EXAMPLE: /Solutions/patch/SolutionUpdate
@try_manual
def step__solutions_patch_solutionupdate(test, rg_2, rg):
    test.cmd('az operationsmanagement solution update '
             '--tags Dept="IT" Environment="Test" '
             '--resource-group "{rg}" '
             '--name "{mySolution}"',
             checks=[
                 test.check("location", "East US", case_sensitive=False),
                 test.check("plan.name", "name1", case_sensitive=False),
                 test.check("plan.product", "product1", case_sensitive=False),
                 test.check("plan.promotionCode", "promocode1", case_sensitive=False),
                 test.check("plan.publisher", "publisher1", case_sensitive=False),
                 test.check("name", "{mySolution}", case_sensitive=False),
                 test.check("tags.Dept", "IT", case_sensitive=False),
                 test.check("tags.Environment", "Test", case_sensitive=False),
             ])


# EXAMPLE: /Solutions/delete/SolutionDelete
@try_manual
def step__solutions_delete_solutiondelete(test, rg_2, rg):
    test.cmd('az operationsmanagement solution delete -y '
             '--resource-group "{rg}" '
             '--name "{mySolution}"',
             checks=[])


# Env cleanup
@try_manual
def cleanup(test, rg_2, rg):
    pass


# Testcase
@try_manual
def call_scenario(test, rg_2, rg):
    setup(test, rg_2, rg)
    step__managementassociations_put_solutioncreate(test, rg_2, rg)
    step__managementassociations_get_solutionget(test, rg_2, rg)
    step__managementassociations_get_solutionlist(test, rg_2, rg)
    step__managementassociations_delete_solutiondelete(test, rg_2, rg)
    step__managementconfigurations_put(test, rg_2, rg)
    step__managementconfigurations_get_solutionget(test, rg_2, rg)
    step__managementconfigurations_get_solutionlist(test, rg_2, rg)
    step__managementconfigurations_delete(test, rg_2, rg)
    step__solutions_put_solutioncreate(test, rg_2, rg)
    step__solutions_get_solutionget(test, rg_2, rg)
    step__solutions_get_solutionlist(test, rg_2, rg)
    step__solutions_get_solutionlist(test, rg_2, rg)
    step__solutions_patch_solutionupdate(test, rg_2, rg)
    step__solutions_delete_solutiondelete(test, rg_2, rg)
    cleanup(test, rg_2, rg)


@try_manual
class OperationsManagementClientScenarioTest(ScenarioTest):

    @ResourceGroupPreparer(name_prefix='clitestoperationsmanagement_rg2'[:7], key='rg_2', parameter_name='rg_2')
    @ResourceGroupPreparer(name_prefix='clitestoperationsmanagement_rg1'[:7], key='rg', parameter_name='rg')
    def test_operationsmanagement(self, rg_2, rg):

        self.kwargs.update({
            'subscription_id': self.get_subscription_id()
        })

        self.kwargs.update({
            'mySolution': 'solution1',
            'myManagementAssociation': 'managementAssociation1',
            'myManagementAssociation2': 'managementAssociationName',
            'myManagementConfiguration': 'managementConfigurationName',
            'myManagementConfiguration2': 'managementConfiguration1',
        })

        call_scenario(self, rg_2, rg)
        calc_coverage(__file__)
        raise_if()
