# --------------------------------------------------------------------------
# Copyright (c) Microsoft Corporation. All rights reserved.
# Licensed under the MIT License. See License.txt in the project root for
# license information.
#
# Code generated by Microsoft (R) AutoRest Code Generator.
# Changes may cause incorrect behavior and will be lost if the code is
# regenerated.
# --------------------------------------------------------------------------

import os
from azure.cli.testsdk import ScenarioTest
from .. import try_manual, raise_if
from azure.cli.testsdk import ResourceGroupPreparer


TEST_DIR = os.path.abspath(os.path.join(os.path.abspath(__file__), '..'))


@try_manual
def setup(test, rg):
    pass


# EXAMPLE: /Actions/get/Get all actions of alert rule.
@try_manual
def step__actions_get_get_all_actions_of_alert_rule_(test, rg):
    test.cmd('az sentinel action list '
             '--resource-group "{rg}" '
             '--rule-id "73e01a99-5cd7-4139-a149-9f2736ff2ab5" '
             '--workspace-name "myWorkspace"',
             checks=[])


# EXAMPLE: /AlertRuleTemplates/get/Get alert rule template by Id.
@try_manual
def step__alertruletemplates_get_get_alert_rule_template_by_id_(test, rg):
    test.cmd('az sentinel alert-rule-template show '
             '--alert-rule-template-id "65360bb0-8986-4ade-a89d-af3cf44d28aa" '
             '--resource-group "{rg}" '
             '--workspace-name "myWorkspace"',
             checks=[])


# EXAMPLE: /AlertRuleTemplates/get/Get all alert rule templates.
@try_manual
def step__alertruletemplates_get_get_all_alert_rule_templates_(test, rg):
    test.cmd('az sentinel alert-rule-template list '
             '--resource-group "{rg}" '
             '--workspace-name "myWorkspace"',
             checks=[])


# EXAMPLE: /AlertRules/put/Creates or updates a Fusion alert rule.
@try_manual
def step__alertrules_put_creates_or_updates_a_fusion_alert_rule_(test, rg):
    test.cmd('az sentinel alert-rule create '
             '--fusion-alert-rule etag="3d00c3ca-0000-0100-0000-5d42d5010000" alert-rule-template-name="f71aba3d-28fb-4'
             '50b-b192-4e76a83015c8" enabled=true '
             '--resource-group "{rg}" '
             '--rule-id "myFirstFusionRule" '
             '--workspace-name "myWorkspace"',
             checks=[])


# EXAMPLE: /AlertRules/put/Creates or updates a MicrosoftSecurityIncidentCreation rule.
@try_manual
def step__alertrules_put_creates_or_updates_a_microsoftsecurityincidentcreation_rule_(test, rg):
    test.cmd('az sentinel alert-rule create '
             '--microsoft-security-incident-creation-alert-rule etag="\\"260097e0-0000-0d00-0000-5d6fa88f0000\\"" produ'
             'ct-filter="Microsoft Cloud App Security" display-name="testing displayname" enabled=true '
             '--resource-group "{rg}" '
             '--rule-id "microsoftSecurityIncidentCreationRuleExample" '
             '--workspace-name "myWorkspace"',
             checks=[])


# EXAMPLE: /AlertRules/put/Creates or updates a Scheduled alert rule.
@try_manual
def step__alertrules_put_creates_or_updates_a_scheduled_alert_rule_(test, rg):
    test.cmd('az sentinel alert-rule create '
             '--scheduled-alert-rule etag="\\"0300bf09-0000-0000-0000-5c37296e0000\\"" query="ProtectionStatus | extend'
             ' HostCustomEntity  query-frequency="PT1H" query-period="P2DT1H30M" severity="High" trigger-operator="Grea'
             'terThan" trigger-threshold=0 description="" display-name="Rule2" enabled=true suppression-duration="PT1H"'
             ' suppression-enabled=false tactics="Persistence" tactics="LateralMovement" '
             '--resource-group "{rg}" '
             '--rule-id "73e01a99-5cd7-4139-a149-9f2736ff2ab5" '
             '--workspace-name "myWorkspace"',
             checks=[])


# EXAMPLE: /AlertRules/put/Creates or updates an action of alert rule.
@try_manual
def step__alertrules_put_creates_or_updates_an_action_of_alert_rule_(test, rg):
    test.cmd('az sentinel alert-rule create '
             '--etag "\\"0300bf09-0000-0000-0000-5c37296e0000\\"" '
             '--logic-app-resource-id "/subscriptions/{subscription_id}/resourceGroups/{rg}/providers/Microsoft.Logic/w'
             'orkflows/MyAlerts" '
             '--trigger-uri "https://prod-31.northcentralus.logic.azure.com:443/workflows/cd3765391efd48549fd7681ded1d4'
             '8d7/triggers/manual/paths/invoke?api-version=2016-10-01&sp=%2Ftriggers%2Fmanual%2Frun&sv=1.0&sig=signatur'
             'e" '
             '--action-id "912bec42-cb66-4c03-ac63-1761b6898c3e" '
             '--resource-group "{rg}" '
             '--rule-id "73e01a99-5cd7-4139-a149-9f2736ff2ab5" '
             '--workspace-name "myWorkspace"',
             checks=[])


# EXAMPLE: /AlertRules/get/Get a Fusion alert rule.
@try_manual
def step__alertrules_get_get_a_fusion_alert_rule_(test, rg):
    test.cmd('az sentinel alert-rule show '
             '--resource-group "{rg}" '
             '--rule-id "myFirstFusionRule" '
             '--workspace-name "myWorkspace"',
             checks=[])


# EXAMPLE: /AlertRules/get/Get a MicrosoftSecurityIncidentCreation rule.
@try_manual
def step__alertrules_get_get_a_microsoftsecurityincidentcreation_rule_(test, rg):
    test.cmd('az sentinel alert-rule show '
             '--resource-group "{rg}" '
             '--rule-id "microsoftSecurityIncidentCreationRuleExample" '
             '--workspace-name "myWorkspace"',
             checks=[])


# EXAMPLE: /AlertRules/get/Get a Scheduled alert rule.
@try_manual
def step__alertrules_get_get_a_scheduled_alert_rule_(test, rg):
    test.cmd('az sentinel alert-rule show '
             '--resource-group "{rg}" '
             '--rule-id "73e01a99-5cd7-4139-a149-9f2736ff2ab5" '
             '--workspace-name "myWorkspace"',
             checks=[])


# EXAMPLE: /AlertRules/get/Get all alert rules.
@try_manual
def step__alertrules_get_get_all_alert_rules_(test, rg):
    test.cmd('az sentinel alert-rule list '
             '--resource-group "{rg}" '
             '--workspace-name "myWorkspace"',
             checks=[])


# EXAMPLE: /AlertRules/get/Get an action of alert rule.
@try_manual
def step__alertrules_get_get_an_action_of_alert_rule_(test, rg):
    test.cmd('az sentinel alert-rule get-action '
             '--action-id "912bec42-cb66-4c03-ac63-1761b6898c3e" '
             '--resource-group "{rg}" '
             '--rule-id "73e01a99-5cd7-4139-a149-9f2736ff2ab5" '
             '--workspace-name "myWorkspace"',
             checks=[])


# EXAMPLE: /Bookmarks/put/Creates or updates a bookmark.
@try_manual
def step__bookmarks_put_creates_or_updates_a_bookmark_(test, rg):
    test.cmd('az sentinel bookmark create '
             '--etag "\\"0300bf09-0000-0000-0000-5c37296e0000\\"" '
             '--created "2019-01-01T13:15:30Z" '
             '--created-by-object-id "2046feea-040d-4a46-9e2b-91c2941bfa70" '
             '--display-name "My bookmark" '
             '--labels "[\\"Tag1\\",\\"Tag2\\"]" '
             '--notes "Found a suspicious activity" '
             '--query "SecurityEvent | where TimeGenerated > ago(1d) and TimeGenerated < ago(2d)" '
             '--query-result "Security Event query result" '
             '--updated "2019-01-01T13:15:30Z" '
             '--bookmark-id "73e01a99-5cd7-4139-a149-9f2736ff2ab5" '
             '--resource-group "{rg}" '
             '--workspace-name "myWorkspace"',
             checks=[])


# EXAMPLE: /Bookmarks/get/Get a bookmark.
@try_manual
def step__bookmarks_get_get_a_bookmark_(test, rg):
    test.cmd('az sentinel bookmark show '
             '--bookmark-id "73e01a99-5cd7-4139-a149-9f2736ff2ab5" '
             '--resource-group "{rg}" '
             '--workspace-name "myWorkspace"',
             checks=[])


# EXAMPLE: /Bookmarks/get/Get all bookmarks.
@try_manual
def step__bookmarks_get_get_all_bookmarks_(test, rg):
    test.cmd('az sentinel bookmark list '
             '--resource-group "{rg}" '
             '--workspace-name "myWorkspace"',
             checks=[])


# EXAMPLE: /DataConnectors/put/Creates or updates an Office365 data connector.
@try_manual
def step__dataconnectors_put_creates_or_updates_an_office365_data_connector_(test, rg):
    test.cmd('az sentinel data-connector create '
             '--office-data-connector etag="\\"0300bf09-0000-0000-0000-5c37296e0000\\"" tenant-id="2070ecc9-b4d5-4ae4-a'
             'daa-936fa1954fa8" state="Enabled" '
             '--data-connector-id "73e01a99-5cd7-4139-a149-9f2736ff2ab5" '
             '--resource-group "{rg}" '
             '--workspace-name "myWorkspace"',
             checks=[])


# EXAMPLE: /DataConnectors/get/Get a ASC data connector.
@try_manual
def step__dataconnectors_get_get_a_asc_data_connector_(test, rg):
    test.cmd('az sentinel data-connector show '
             '--data-connector-id "763f9fa1-c2d3-4fa2-93e9-bccd4899aa12" '
             '--resource-group "{rg}" '
             '--workspace-name "myWorkspace"',
             checks=[])


# EXAMPLE: /DataConnectors/get/Get a MCAS data connector.
@try_manual
def step__dataconnectors_get_get_a_mcas_data_connector_(test, rg):
    test.cmd('az sentinel data-connector show '
             '--data-connector-id "b96d014d-b5c2-4a01-9aba-a8058f629d42" '
             '--resource-group "{rg}" '
             '--workspace-name "myWorkspace"',
             checks=[])


# EXAMPLE: /DataConnectors/get/Get a MDATP data connector
@try_manual
def step__dataconnectors_get_get_a_mdatp_data_connector(test, rg):
    test.cmd('az sentinel data-connector show '
             '--data-connector-id "06b3ccb8-1384-4bcc-aec7-852f6d57161b" '
             '--resource-group "{rg}" '
             '--workspace-name "myWorkspace"',
             checks=[])


# EXAMPLE: /DataConnectors/get/Get a TI data connector.
@try_manual
def step__dataconnectors_get_get_a_ti_data_connector_(test, rg):
    test.cmd('az sentinel data-connector show '
             '--data-connector-id "c345bf40-8509-4ed2-b947-50cb773aaf04" '
             '--resource-group "{rg}" '
             '--workspace-name "myWorkspace"',
             checks=[])


# EXAMPLE: /DataConnectors/get/Get all data connectors.
@try_manual
def step__dataconnectors_get_get_all_data_connectors_(test, rg):
    test.cmd('az sentinel data-connector list '
             '--resource-group "{rg}" '
             '--workspace-name "myWorkspace"',
             checks=[])


# EXAMPLE: /DataConnectors/get/Get an AAD data connector.
@try_manual
def step__dataconnectors_get_get_an_aad_data_connector_(test, rg):
    test.cmd('az sentinel data-connector show '
             '--data-connector-id "f0cd27d2-5f03-4c06-ba31-d2dc82dcb51d" '
             '--resource-group "{rg}" '
             '--workspace-name "myWorkspace"',
             checks=[])


# EXAMPLE: /DataConnectors/get/Get an AATP data connector.
@try_manual
def step__dataconnectors_get_get_an_aatp_data_connector_(test, rg):
    test.cmd('az sentinel data-connector show '
             '--data-connector-id "07e42cb3-e658-4e90-801c-efa0f29d3d44" '
             '--resource-group "{rg}" '
             '--workspace-name "myWorkspace"',
             checks=[])


# EXAMPLE: /DataConnectors/get/Get an AwsCloudTrail data connector.
@try_manual
def step__dataconnectors_get_get_an_awscloudtrail_data_connector_(test, rg):
    test.cmd('az sentinel data-connector show '
             '--data-connector-id "c345bf40-8509-4ed2-b947-50cb773aaf04" '
             '--resource-group "{rg}" '
             '--workspace-name "myWorkspace"',
             checks=[])


# EXAMPLE: /DataConnectors/get/Get an Office365 data connector.
@try_manual
def step__dataconnectors_get_get_an_office365_data_connector_(test, rg):
    test.cmd('az sentinel data-connector show '
             '--data-connector-id "73e01a99-5cd7-4139-a149-9f2736ff2ab5" '
             '--resource-group "{rg}" '
             '--workspace-name "myWorkspace"',
             checks=[])


# EXAMPLE: /IncidentComments/put/Creates an incident comment.
@try_manual
def step__incidentcomments_put_creates_an_incident_comment_(test, rg):
    test.cmd('az sentinel incident-comment create '
             '--message "Some message" '
             '--incident-comment-id "4bb36b7b-26ff-4d1c-9cbe-0d8ab3da0014" '
             '--incident-id "73e01a99-5cd7-4139-a149-9f2736ff2ab5" '
             '--resource-group "{rg}" '
             '--workspace-name "myWorkspace"',
             checks=[])


# EXAMPLE: /IncidentComments/get/Get all incident comments.
@try_manual
def step__incidentcomments_get_get_all_incident_comments_(test, rg):
    test.cmd('az sentinel incident-comment list '
             '--incident-id "73e01a99-5cd7-4139-a149-9f2736ff2ab5" '
             '--resource-group "{rg}" '
             '--workspace-name "myWorkspace"',
             checks=[])


# EXAMPLE: /IncidentComments/get/Get an incident comment.
@try_manual
def step__incidentcomments_get_get_an_incident_comment_(test, rg):
    test.cmd('az sentinel incident-comment show '
             '--incident-comment-id "4bb36b7b-26ff-4d1c-9cbe-0d8ab3da0014" '
             '--incident-id "73e01a99-5cd7-4139-a149-9f2736ff2ab5" '
             '--resource-group "{rg}" '
             '--workspace-name "myWorkspace"',
             checks=[])


# EXAMPLE: /Incidents/put/Creates or updates an incident.
@try_manual
def step__incidents_put_creates_or_updates_an_incident_(test, rg):
    test.cmd('az sentinel incident create '
             '--etag "\\"0300bf09-0000-0000-0000-5c37296e0000\\"" '
             '--description "This is a demo incident" '
             '--classification "FalsePositive" '
             '--classification-comment "Not a malicious activity" '
             '--classification-reason "IncorrectAlertLogic" '
             '--first-activity-time-utc "2019-01-01T13:00:30Z" '
             '--last-activity-time-utc "2019-01-01T13:05:30Z" '
             '--owner object-id="2046feea-040d-4a46-9e2b-91c2941bfa70" '
             '--severity "High" '
             '--status "Closed" '
             '--title "My incident" '
             '--incident-id "73e01a99-5cd7-4139-a149-9f2736ff2ab5" '
             '--resource-group "{rg}" '
             '--workspace-name "myWorkspace"',
             checks=[])


# EXAMPLE: /Incidents/get/Get all incidents.
@try_manual
def step__incidents_get_get_all_incidents_(test, rg):
    test.cmd('az sentinel incident list '
             '--orderby "properties/createdTimeUtc desc" '
             '--top 1 '
             '--resource-group "{rg}" '
             '--workspace-name "myWorkspace"',
             checks=[])


# EXAMPLE: /Incidents/get/Get an incident.
@try_manual
def step__incidents_get_get_an_incident_(test, rg):
    test.cmd('az sentinel incident show '
             '--incident-id "73e01a99-5cd7-4139-a149-9f2736ff2ab5" '
             '--resource-group "{rg}" '
             '--workspace-name "myWorkspace"',
             checks=[])


# EXAMPLE: /AlertRules/delete/Delete an alert rule.
@try_manual
def step__alertrules_delete_delete_an_alert_rule_(test, rg):
    test.cmd('az sentinel alert-rule delete '
             '--resource-group "{rg}" '
             '--rule-id "73e01a99-5cd7-4139-a149-9f2736ff2ab5" '
             '--workspace-name "myWorkspace"',
             checks=[])


# EXAMPLE: /AlertRules/delete/Delete an action of alert rule.
@try_manual
def step__alertrules_delete_delete_an_action_of_alert_rule_(test, rg):
    test.cmd('az sentinel alert-rule delete '
             '--action-id "912bec42-cb66-4c03-ac63-1761b6898c3e" '
             '--resource-group "{rg}" '
             '--rule-id "73e01a99-5cd7-4139-a149-9f2736ff2ab5" '
             '--workspace-name "myWorkspace"',
             checks=[])


# EXAMPLE: /Bookmarks/delete/Delete a bookmark.
@try_manual
def step__bookmarks_delete_delete_a_bookmark_(test, rg):
    test.cmd('az sentinel bookmark delete '
             '--bookmark-id "73e01a99-5cd7-4139-a149-9f2736ff2ab5" '
             '--resource-group "{rg}" '
             '--workspace-name "myWorkspace"',
             checks=[])


# EXAMPLE: /DataConnectors/delete/Delete an Office365 data connector.
@try_manual
def step__dataconnectors_delete_delete_an_office365_data_connector_(test, rg):
    test.cmd('az sentinel data-connector delete '
             '--data-connector-id "73e01a99-5cd7-4139-a149-9f2736ff2ab5" '
             '--resource-group "{rg}" '
             '--workspace-name "myWorkspace"',
             checks=[])


# EXAMPLE: /Incidents/delete/Delete an incident.
@try_manual
def step__incidents_delete_delete_an_incident_(test, rg):
    test.cmd('az sentinel incident delete '
             '--incident-id "73e01a99-5cd7-4139-a149-9f2736ff2ab5" '
             '--resource-group "{rg}" '
             '--workspace-name "myWorkspace"',
             checks=[])


@try_manual
def cleanup(test, rg):
    pass


@try_manual
def call_scenario(test, rg):
    setup(test, rg)
    step__actions_get_get_all_actions_of_alert_rule_(test, rg)
    step__alertruletemplates_get_get_alert_rule_template_by_id_(test, rg)
    step__alertruletemplates_get_get_all_alert_rule_templates_(test, rg)
    step__alertrules_put_creates_or_updates_a_fusion_alert_rule_(test, rg)
    step__alertrules_put_creates_or_updates_a_microsoftsecurityincidentcreation_rule_(test, rg)
    step__alertrules_put_creates_or_updates_a_scheduled_alert_rule_(test, rg)
    step__alertrules_put_creates_or_updates_an_action_of_alert_rule_(test, rg)
    step__alertrules_get_get_a_fusion_alert_rule_(test, rg)
    step__alertrules_get_get_a_microsoftsecurityincidentcreation_rule_(test, rg)
    step__alertrules_get_get_a_scheduled_alert_rule_(test, rg)
    step__alertrules_get_get_all_alert_rules_(test, rg)
    step__alertrules_get_get_an_action_of_alert_rule_(test, rg)
    step__bookmarks_put_creates_or_updates_a_bookmark_(test, rg)
    step__bookmarks_get_get_a_bookmark_(test, rg)
    step__bookmarks_get_get_all_bookmarks_(test, rg)
    step__dataconnectors_put_creates_or_updates_an_office365_data_connector_(test, rg)
    step__dataconnectors_get_get_a_asc_data_connector_(test, rg)
    step__dataconnectors_get_get_a_mcas_data_connector_(test, rg)
    step__dataconnectors_get_get_a_mdatp_data_connector(test, rg)
    step__dataconnectors_get_get_a_ti_data_connector_(test, rg)
    step__dataconnectors_get_get_all_data_connectors_(test, rg)
    step__dataconnectors_get_get_an_aad_data_connector_(test, rg)
    step__dataconnectors_get_get_an_aatp_data_connector_(test, rg)
    step__dataconnectors_get_get_an_awscloudtrail_data_connector_(test, rg)
    step__dataconnectors_get_get_an_office365_data_connector_(test, rg)
    step__incidentcomments_put_creates_an_incident_comment_(test, rg)
    step__incidentcomments_get_get_all_incident_comments_(test, rg)
    step__incidentcomments_get_get_an_incident_comment_(test, rg)
    step__incidents_put_creates_or_updates_an_incident_(test, rg)
    step__incidents_get_get_all_incidents_(test, rg)
    step__incidents_get_get_an_incident_(test, rg)
    step__alertrules_delete_delete_an_alert_rule_(test, rg)
    step__alertrules_delete_delete_an_action_of_alert_rule_(test, rg)
    step__bookmarks_delete_delete_a_bookmark_(test, rg)
    step__dataconnectors_delete_delete_an_office365_data_connector_(test, rg)
    step__incidents_delete_delete_an_incident_(test, rg)
    cleanup(test, rg)


@try_manual
class SecurityInsightsScenarioTest(ScenarioTest):

    @ResourceGroupPreparer(name_prefix='clitestsentinel_myRg'[:7], key='rg', parameter_name='rg')
    def test_sentinel(self, rg):

        self.kwargs.update({
            'subscription_id': self.get_subscription_id()
        })

        call_scenario(self, rg)
        raise_if()
