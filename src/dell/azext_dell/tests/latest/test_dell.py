# --------------------------------------------------------------------------------------------
# Copyright (c) Microsoft Corporation. All rights reserved.
# Licensed under the MIT License. See License.txt in the project root for license information.
#
# Code generated by aaz-dev-tools
# --------------------------------------------------------------------------------------------

# pylint: disable=line-too-long
# pylint: disable=too-many-lines

from azure.cli.testsdk import *


class DellScenario(ScenarioTest):

    @live_only()
    @ResourceGroupPreparer(location='eastus')
    def test_dell_filesystem(self):
        # Get user email for user details
        email = self.cmd('account show').get_output_in_json()['user']['name']
        
        self.kwargs.update({
            'vnet': self.create_random_name('vnet', 10),
            'subnet': self.create_random_name('subnet', 15),
            'filesystem_name': self.create_random_name('dellfs', 12),
            'email': email,
            'location': 'eastus'
        })
        
        # Create VNet and subnet for Dell filesystem
        self.cmd('network vnet create -n {vnet} -g {rg} --address-prefix 10.0.0.0/16 --location {location}')
        subnet_id = self.cmd('network vnet subnet create -n {subnet} -g {rg} --address-prefix 10.0.0.0/24 --vnet-name {vnet} --delegations Dell.Storage/fileSystems').get_output_in_json()['id']
        
        self.kwargs.update({
            'subnet_id': subnet_id
        })
        
        # Create Dell filesystem
        self.cmd('dell filesystem create -n {filesystem_name} -g {rg} --location {location} '
                 '--delegated-subnet-id {subnet_id} '
                 '--delegated-subnet-cidr 10.0.0.0/24 '
                 '--marketplace \'{{"offer-id":"dell-powerscale","plan-id":"dell-powerscale-plan","plan-name":"Dell PowerScale Plan","publisher-id":"dell","marketplace-subscription-id":"test-subscription"}}\' '
                 '--user \'{{"email":"{email}"}}\' '
                 '--tags \'{{"environment":"test","owner":"azure-cli"}}\'',
                 checks=[
                     self.check('name', '{filesystem_name}'),
                     self.check('location', '{location}'),
                     self.check('delegatedSubnetId', '{subnet_id}'),
                     self.check('delegatedSubnetCidr', '10.0.0.0/24'),
                     self.check('marketplace.offerId', 'dell-powerscale'),
                     self.check('marketplace.planId', 'dell-powerscale-plan'),
                     self.check('marketplace.planName', 'Dell PowerScale Plan'),
                     self.check('marketplace.publisherId', 'dell'),
                     self.check('user.email', '{email}'),
                     self.check('tags.environment', 'test'),
                     self.check('tags.owner', 'azure-cli')
                 ])
        
        # Show Dell filesystem
        self.cmd('dell filesystem show -n {filesystem_name} -g {rg}',
                 checks=[
                     self.check('name', '{filesystem_name}'),
                     self.check('location', '{location}'),
                     self.check('delegatedSubnetId', '{subnet_id}'),
                     self.check('delegatedSubnetCidr', '10.0.0.0/24'),
                     self.check('marketplace.offerId', 'dell-powerscale'),
                     self.check('marketplace.planId', 'dell-powerscale-plan'),
                     self.check('user.email', '{email}')
                 ])
        
        # List Dell filesystems by resource group
        self.cmd('dell filesystem list -g {rg}',
                 checks=[
                     self.check('[0].name', '{filesystem_name}'),
                     self.check('[0].location', '{location}'),
                     self.check('[0].delegatedSubnetId', '{subnet_id}')
                 ])
        
        # Update Dell filesystem tags
        self.cmd('dell filesystem update -n {filesystem_name} -g {rg} --tags \'{{"environment":"production","updated":"true"}}\'',
                 checks=[
                     self.check('name', '{filesystem_name}'),
                     self.check('tags.environment', 'production'),
                     self.check('tags.updated', 'true')
                 ])
        
        # Delete Dell filesystem
        self.cmd('dell filesystem delete -n {filesystem_name} -g {rg} -y',
                 checks=[])
