# # --------------------------------------------------------------------------------------------
# Copyright (c) Microsoft Corporation. All rights reserved.
# Licensed under the MIT License. See License.txt in the project root for license information.
# # --------------------------------------------------------------------------------------------

import os
from typing import Dict

from jinja2 import Template


def get_tests_path():
    code_directory = os.path.dirname(__file__)
    tests_directory = os.path.join(code_directory, "../")
    return tests_directory


def update_input_file(input_template_name, output_file_name, params: Dict[str, str]):
    tests_directory = get_tests_path()
    templates_directory = os.path.join(
        tests_directory, "latest", "input_file_templates"
    )
    output_files_directory = os.path.join(
        tests_directory, "latest", "autogenerated_test_files"
    )
    os.makedirs(output_files_directory, exist_ok=True)

    input_template_path = os.path.join(templates_directory, input_template_name)

    with open(input_template_path, "r", encoding="utf-8") as file:
        contents = file.read()

    jinja_template = Template(contents)

    rendered_template = jinja_template.render(**params)

    output_path = os.path.join(output_files_directory, output_file_name)

    with open(output_path, "w", encoding="utf-8") as file:
        file.write(rendered_template)

    return output_path
