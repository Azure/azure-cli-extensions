# --------------------------------------------------------------------------------------------
# Copyright (c) Microsoft Corporation. All rights reserved.
# Licensed under the MIT License. See License.txt in the project root for license information.
#
# Code generated by aaz-dev-tools
# --------------------------------------------------------------------------------------------

from azure.cli.testsdk import *
from azure.cli.testsdk.scenario_tests import AllowLargeResponse


class PscloudScenario(ScenarioTest):
    # TODO: add tests here
    def test_pscloud_reservation_crud(self):
        self.cmd("az pscloud list", checks=[
                     self.greater_than('length(@)', 0)
                 ])
        self.cmd("az pscloud show --resource-group aaa --reservation-name cliTestReservationCUS", checks=[
            self.check('reservationInternalId', '4bd52cb0-745a-11f0-ae52-b65160902b53')
        ])

    def test_pscloud_storagepool_create(self):
        """Test pscloud pool create command"""
        # Create storagepool command with proper JSON quoting for vnet-injection
        create_storagepool_cmd = """az pscloud pool create --resource-group abc --storage-pool-name dhritijindal123 --location "Central US" -z "1" --subnet-name "/subscriptions/834be33e-67e6-45ed-a454-c25a34cdec1f/resourceGroups/abc/providers/Microsoft.Network/virtualNetworks/cli-pure-vnet/subnets/delgSubnet" --vnet-name "/subscriptions/834be33e-67e6-45ed-a454-c25a34cdec1f/resourceGroups/abc/providers/Microsoft.Network/virtualNetworks/cli-pure-vnet" --provisioned-bandwidth 992 --reservation-id "/subscriptions/834be33e-67e6-45ed-a454-c25a34cdec1f/resourceGroups/abc/providers/PureStorage.Block/reservations/cli-test-reserv" --debug"""

        # Execute the create command
        self.cmd(create_storagepool_cmd)

    @AllowLargeResponse()
    def test_pscloud_storagepool_get(self):
        """Test pool show, list commands with basic field checks"""

        # 1. Test storagepool show
        self.cmd(
            "az pscloud pool show --resource-group abc --storage-pool-name dhritijindal",
            checks=[
                self.exists('id'),
                self.exists('name'),
                self.exists('location'),
                self.exists('vnetInjection'),
                self.exists('provisionedBandwidthMbPerSec')
            ]
        )

        # 2. Test storagepool list
        self.cmd(
            "az pscloud pool list",
            checks=[
                self.greater_than('length(@)', 0)
            ]
        )

    def test_pscloud_storagepool_postAction(self):
        # 3. Test storagepool get-health-status
        self.cmd(
            "az pscloud pool get-health-status --resource-group abc -n dhritijindal",
            checks=[
                self.exists('health'),
                self.exists('health.bandwidthUsage'),
                self.exists('health.iopsUsage'),
                self.exists('health.space')
            ]
        )    
        self.cmd(
            "az pscloud pool get-avs-status --resource-group abc -n dhritijindal",
            checks=[
                self.exists('currentConnectionStatus')
            ]
        )

    def test_pscloud_storagepool_update(self):
        """Test pscloud pool update command"""
        # Test updating provisioned bandwidth
        self.cmd(
            "az pscloud pool update --resource-group abc --name dhritijindal --provisioned-bandwidth 1094"
        )
    def test_pscloud_storagepool_delete(self):
        """Test pscloud pool delete command"""
        # Test deleting a storage pool
        self.cmd(
            "az pscloud pool delete --resource-group abc --storage-pool-name dhritijindal123 --yes"
        )    
    pass
