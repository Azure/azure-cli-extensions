# --------------------------------------------------------------------------
# Copyright (c) Microsoft Corporation. All rights reserved.
# Licensed under the MIT License. See License.txt in the project root for
# license information.
#
# Code generated by Microsoft (R) AutoRest Code Generator.
# Changes may cause incorrect behavior and will be lost if the code is
# regenerated.
# --------------------------------------------------------------------------

import os
import unittest

from azure_devtools.scenario_tests import AllowLargeResponse
from azure.cli.testsdk import ScenarioTest
from .. import try_manual
from azure.cli.testsdk import ResourceGroupPreparer


TEST_DIR = os.path.abspath(os.path.join(os.path.abspath(__file__), '..'))


@try_manual
def setup(test, rg):
    pass


# EXAMPLE: /PipelineTemplateDefinitions/get/Get the list of pipeline template definitions
@try_manual
def step__pipelinetemplatedefinitions_get_get_the_list_of_pipeline_template_definitions(test, rg):
    test.cmd('az devops pipeline-template-definition list',
             checks=[])


# EXAMPLE: /Pipelines/put/Create an Azure pipeline to deploy a sample ASP.Net application to Azure web-app
@try_manual
def step__pipelines_put_create_an_azure_pipeline_to_deploy_a_sample_asp_net_application_to_azure_web_app(test, rg):
    test.cmd('az devops pipeline create '
             '--location "South India" '
             '--bootstrap-configuration-repository-properties bootstrapConfiguration={{"template":{{"id":"ms.vss-contin'
             'uous-delivery-pipeline-templates.aspnet-windowswebapp","parameters":{{"appInsightLocation":"South India",'
             '"appServicePlan":"S1 Standard","azureAuth":"{{\\"scheme\\":\\"ServicePrincipal\\",\\"parameters\\":{{\\"t'
             'enantid\\":\\"{{subscriptionTenantId}}\\",\\"objectid\\":\\"{{appObjectId}}\\",\\"serviceprincipalid\\":'
             '\\"{{appId}}\\",\\"serviceprincipalkey\\":\\"{{appSecret}}\\"}}}}","location":"South India","resourceGrou'
             'p":"myAspNetWebAppPipeline-rg","subscriptionId":"{{subscriptionId}}","webAppName":"myAspNetWebApp"}}}}}} '
             'organization={{"name":"myAspNetWebAppPipeline-org"}} project={{"name":"myAspNetWebAppPipeline-project"}} '
             ''
             '--pipeline-name "{myAspNetWebAppPipeline}" '
             '--resource-group "{rg}"',
             checks=[])


# EXAMPLE: /Pipelines/get/Get an existing Azure pipeline
@try_manual
def step__pipelines_get_get_an_existing_azure_pipeline(test, rg):
    test.cmd('az devops pipeline show '
             '--pipeline-name "{myAspNetWebAppPipeline}" '
             '--resource-group "{rg}"',
             checks=[])


# EXAMPLE: /Pipelines/get/List all Azure Pipelines under the specified resource group
@try_manual
def step__pipelines_get_list_all_azure_pipelines_under_the_specified_resource_group(test, rg):
    test.cmd('az devops pipeline list '
             '--resource-group "{rg}"',
             checks=[])


# EXAMPLE: /Pipelines/get/List all Azure pipelines under the specified subscription
@try_manual
def step__pipelines_get_list_all_azure_pipelines_under_the_specified_subscription(test, rg):
    test.cmd('az devops pipeline list',
             checks=[])


# EXAMPLE: /Pipelines/patch/Get an existing Azure pipeline
@try_manual
def step__pipelines_patch_get_an_existing_azure_pipeline(test, rg):
    test.cmd('az devops pipeline update '
             '--pipeline-name "{myAspNetWebAppPipeline}" '
             '--resource-group "{rg}" '
             '--tags tagKey="tagvalue"',
             checks=[])


# EXAMPLE: /Pipelines/delete/Get an existing Azure pipeline
@try_manual
def step__pipelines_delete_get_an_existing_azure_pipeline(test, rg):
    test.cmd('az devops pipeline delete '
             '--pipeline-name "{myAspNetWebAppPipeline}" '
             '--resource-group "{rg}"',
             checks=[])


@try_manual
def cleanup(test, rg):
    pass


@try_manual
def call_scenario(test, rg):
    setup(test, rg)
    step__pipelinetemplatedefinitions_get_get_the_list_of_pipeline_template_definitions(test, rg)
    step__pipelines_put_create_an_azure_pipeline_to_deploy_a_sample_asp_net_application_to_azure_web_app(test, rg)
    step__pipelines_get_get_an_existing_azure_pipeline(test, rg)
    step__pipelines_get_list_all_azure_pipelines_under_the_specified_resource_group(test, rg)
    step__pipelines_get_list_all_azure_pipelines_under_the_specified_subscription(test, rg)
    step__pipelines_patch_get_an_existing_azure_pipeline(test, rg)
    step__pipelines_delete_get_an_existing_azure_pipeline(test, rg)
    cleanup(test, rg)


@try_manual
class AzureDevOpsScenarioTest(ScenarioTest):

    @ResourceGroupPreparer(name_prefix='clitestdevops_myAspNetWebAppPipeline-rg'[:7], key='rg', parameter_name='rg')
    def test_devops(self, rg):

        self.kwargs.update({
            'myAspNetWebAppPipeline': 'myAspNetWebAppPipeline',
        })

        call_scenario(self, rg)
