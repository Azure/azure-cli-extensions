# --------------------------------------------------------------------------------------------
# Copyright (c) Microsoft Corporation. All rights reserved.
# Licensed under the MIT License. See License.txt in the project root for license information.
#
# Code generated by aaz-dev-tools
# --------------------------------------------------------------------------------------------

# pylint: skip-file
# flake8: noqa

from azure.cli.core.aaz import *


@register_command(
    "oracle-database db-system create",
)
class Create(AAZCommand):
    """Create a DbSystem

    :example: DbSystems_Create
        az oracle-database db-system create --resource-group rgo --db-system-name dbsystem1 --database-edition StandardEdition --admin-password ******** --db-version 19.0.0.0 --resource-anchor-id /subscriptions/00000000-0000-4025-0000-000000000000/resourceGroups/rg001/providers/Oracle.Database/resourceAnchors/resourceanchor1 --network-anchor-id /subscriptions/00000000-0000-4025-0000-000000000000/resourceGroups/rg001/providers/Oracle.Database/networkAnchors/networkanchor1 --cluster-name example --display-name example --initial-data-storage-size-in-gb 19 --db-system-options "{storage-management:LVM}" --disk-redundancy High --hostname krixp --node-count 24 --shape VM.Standard.E5.Flex --ssh-public-keys "[sha-xx]" --storage-volume-performance-mode Balanced --time-zone utc --compute-model ECPU --compute-count 28 --zones "[2]" --tags "{tag:test}" --location eastus
    """

    _aaz_info = {
        "version": "2025-09-01",
        "resources": [
            ["mgmt-plane", "/subscriptions/{}/resourcegroups/{}/providers/oracle.database/dbsystems/{}", "2025-09-01"],
        ]
    }

    AZ_SUPPORT_NO_WAIT = True

    def _handler(self, command_args):
        super()._handler(command_args)
        return self.build_lro_poller(self._execute_operations, self._output)

    _args_schema = None

    @classmethod
    def _build_arguments_schema(cls, *args, **kwargs):
        if cls._args_schema is not None:
            return cls._args_schema
        cls._args_schema = super()._build_arguments_schema(*args, **kwargs)

        # define Arg Group ""

        _args_schema = cls._args_schema
        _args_schema.db_system_name = AAZStrArg(
            options=["-n", "--name", "--db-system-name"],
            help="The name of the DbSystem",
            required=True,
            fmt=AAZStrArgFormat(
                pattern=".*",
            ),
        )
        _args_schema.resource_group = AAZResourceGroupNameArg(
            required=True,
        )

        # define Arg Group "Properties"

        _args_schema = cls._args_schema
        _args_schema.admin_password = AAZPasswordArg(
            options=["--admin-password"],
            arg_group="Properties",
            help="A strong password for SYS, SYSTEM, and PDB Admin. The password must be at least nine characters and contain at least two uppercase, two lowercase, two numbers, and two special characters. The special characters must be _, #, or -.",
            fmt=AAZStrArgFormat(
                max_length=255,
                min_length=1,
            ),
            blank=AAZPromptPasswordInput(
                msg="Password:",
            ),
        )
        _args_schema.cluster_name = AAZStrArg(
            options=["--cluster-name"],
            arg_group="Properties",
            help="The cluster name for Exadata and 2-node RAC virtual machine DB systems. The cluster name must begin with an alphabetic character, and may contain hyphens (-). Underscores (_) are not permitted. The cluster name can be no longer than 11 characters and is not case sensitive.",
            fmt=AAZStrArgFormat(
                max_length=11,
                min_length=1,
            ),
        )
        _args_schema.compute_count = AAZIntArg(
            options=["--compute-count"],
            arg_group="Properties",
            help="The number of compute servers for the DB system.",
        )
        _args_schema.compute_model = AAZStrArg(
            options=["--compute-model"],
            arg_group="Properties",
            help="The compute model for Base Database Service. This is required if using the `computeCount` parameter. If using `cpuCoreCount` then it is an error to specify `computeModel` to a non-null value. The ECPU compute model is the recommended model, and the OCPU compute model is legacy.",
            enum={"ECPU": "ECPU", "OCPU": "OCPU"},
        )
        _args_schema.database_edition = AAZStrArg(
            options=["--database-edition"],
            arg_group="Properties",
            help="The Oracle Database Edition that applies to all the databases on the DB system. Exadata DB systems and 2-node RAC DB systems require EnterpriseEditionExtremePerformance.",
            enum={"EnterpriseEdition": "EnterpriseEdition", "EnterpriseEditionDeveloper": "EnterpriseEditionDeveloper", "EnterpriseEditionExtreme": "EnterpriseEditionExtreme", "EnterpriseEditionHighPerformance": "EnterpriseEditionHighPerformance", "StandardEdition": "StandardEdition"},
        )
        _args_schema.db_system_options = AAZObjectArg(
            options=["--db-system-options"],
            arg_group="Properties",
            help="The DB system options.",
        )
        _args_schema.db_version = AAZStrArg(
            options=["--db-version"],
            arg_group="Properties",
            help="A valid Oracle Database version. For a list of supported versions, use the ListDbVersions operation.",
        )
        _args_schema.disk_redundancy = AAZStrArg(
            options=["--disk-redundancy"],
            arg_group="Properties",
            help="The type of redundancy configured for the DB system. NORMAL is 2-way redundancy. HIGH is 3-way redundancy.",
            enum={"High": "High", "Normal": "Normal"},
        )
        _args_schema.display_name = AAZStrArg(
            options=["--display-name"],
            arg_group="Properties",
            help="The user-friendly name for the DB system. The name does not have to be unique.",
            fmt=AAZStrArgFormat(
                max_length=255,
                min_length=1,
            ),
        )
        _args_schema.domain = AAZStrArg(
            options=["--domain"],
            arg_group="Properties",
            help="The domain name for the DB system.",
        )
        _args_schema.hostname = AAZStrArg(
            options=["--hostname"],
            arg_group="Properties",
            help="The hostname for the DB system.",
        )
        _args_schema.initial_data_storage_size_in_gb = AAZIntArg(
            options=["--initial-data-storage-size-in-gb"],
            arg_group="Properties",
            help="Size in GB of the initial data volume that will be created and attached to a virtual machine DB system. You can scale up storage after provisioning, as needed. Note that the total storage size attached will be more than the amount you specify to allow for REDO/RECO space and software volume.",
            default=256,
            fmt=AAZIntArgFormat(
                minimum=2,
            ),
        )
        _args_schema.license_model = AAZStrArg(
            options=["--license-model"],
            arg_group="Properties",
            help="The Oracle license model that applies to all the databases on the DB system. The default is LicenseIncluded.",
            default="LicenseIncluded",
            enum={"BringYourOwnLicense": "BringYourOwnLicense", "LicenseIncluded": "LicenseIncluded"},
        )
        _args_schema.network_anchor_id = AAZResourceIdArg(
            options=["--network-anchor-id"],
            arg_group="Properties",
            help="Azure Network Anchor ID",
        )
        _args_schema.node_count = AAZIntArg(
            options=["--node-count"],
            arg_group="Properties",
            help="The number of nodes in the DB system. For RAC DB systems, the value is greater than 1.",
            default=1,
            fmt=AAZIntArgFormat(
                minimum=1,
            ),
        )
        _args_schema.pdb_name = AAZStrArg(
            options=["--pdb-name"],
            arg_group="Properties",
            help="The name of the pluggable database. The name must begin with an alphabetic character and can contain a maximum of thirty alphanumeric characters. Special characters are not permitted. Pluggable database should not be same as database name.",
        )
        _args_schema.resource_anchor_id = AAZResourceIdArg(
            options=["--resource-anchor-id"],
            arg_group="Properties",
            help="Azure Resource Anchor ID",
        )
        _args_schema.shape = AAZStrArg(
            options=["--shape"],
            arg_group="Properties",
            help="The shape of the DB system. The shape determines resources to allocate to the DB system. For virtual machine shapes, the number of CPU cores and memory. For bare metal and Exadata shapes, the number of CPU cores, storage, and memory.",
            fmt=AAZStrArgFormat(
                max_length=255,
                min_length=1,
            ),
        )
        _args_schema.ssh_public_keys = AAZListArg(
            options=["--ssh-public-keys"],
            arg_group="Properties",
            help="The public key portion of one or more key pairs used for SSH access to the DB system.",
        )
        _args_schema.storage_volume_performance_mode = AAZStrArg(
            options=["--storage-volume-performance-mode"],
            arg_group="Properties",
            help="The block storage volume performance level. Valid values are Balanced and HighPerformance. See [Block Volume Performance](/Content/Block/Concepts/blockvolumeperformance.htm) for more information.",
            enum={"Balanced": "Balanced", "HighPerformance": "HighPerformance"},
        )
        _args_schema.time_zone = AAZStrArg(
            options=["--time-zone"],
            arg_group="Properties",
            help="The time zone of the DB system, e.g., UTC, to set the timeZone as UTC.",
            fmt=AAZStrArgFormat(
                max_length=255,
                min_length=1,
            ),
        )

        db_system_options = cls._args_schema.db_system_options
        db_system_options.storage_management = AAZStrArg(
            options=["storage-management"],
            help="The storage option used in DB system. ASM - Automatic storage management, LVM - Logical Volume management.",
            enum={"LVM": "LVM"},
        )

        ssh_public_keys = cls._args_schema.ssh_public_keys
        ssh_public_keys.Element = AAZStrArg(
            fmt=AAZStrArgFormat(
                max_length=1024,
                min_length=1,
            ),
        )

        # define Arg Group "Resource"

        _args_schema = cls._args_schema
        _args_schema.location = AAZResourceLocationArg(
            arg_group="Resource",
            help="The geo-location where the resource lives",
            required=True,
            fmt=AAZResourceLocationArgFormat(
                resource_group_arg="resource_group",
            ),
        )
        _args_schema.tags = AAZDictArg(
            options=["--tags"],
            arg_group="Resource",
            help="Resource tags.",
        )
        _args_schema.zones = AAZListArg(
            options=["--zones"],
            arg_group="Resource",
            help="The availability zones.",
        )

        tags = cls._args_schema.tags
        tags.Element = AAZStrArg()

        zones = cls._args_schema.zones
        zones.Element = AAZStrArg()
        return cls._args_schema

    def _execute_operations(self):
        self.pre_operations()
        yield self.DbSystemsCreateOrUpdate(ctx=self.ctx)()
        self.post_operations()

    @register_callback
    def pre_operations(self):
        pass

    @register_callback
    def post_operations(self):
        pass

    def _output(self, *args, **kwargs):
        result = self.deserialize_output(self.ctx.vars.instance, client_flatten=True)
        return result

    class DbSystemsCreateOrUpdate(AAZHttpOperation):
        CLIENT_TYPE = "MgmtClient"

        def __call__(self, *args, **kwargs):
            request = self.make_request()
            session = self.client.send_request(request=request, stream=False, **kwargs)
            if session.http_response.status_code in [202]:
                return self.client.build_lro_polling(
                    self.ctx.args.no_wait,
                    session,
                    self.on_200_201,
                    self.on_error,
                    lro_options={"final-state-via": "azure-async-operation"},
                    path_format_arguments=self.url_parameters,
                )
            if session.http_response.status_code in [200, 201]:
                return self.client.build_lro_polling(
                    self.ctx.args.no_wait,
                    session,
                    self.on_200_201,
                    self.on_error,
                    lro_options={"final-state-via": "azure-async-operation"},
                    path_format_arguments=self.url_parameters,
                )

            return self.on_error(session.http_response)

        @property
        def url(self):
            return self.client.format_url(
                "/subscriptions/{subscriptionId}/resourceGroups/{resourceGroupName}/providers/Oracle.Database/dbSystems/{dbSystemName}",
                **self.url_parameters
            )

        @property
        def method(self):
            return "PUT"

        @property
        def error_format(self):
            return "MgmtErrorFormat"

        @property
        def url_parameters(self):
            parameters = {
                **self.serialize_url_param(
                    "dbSystemName", self.ctx.args.db_system_name,
                    required=True,
                ),
                **self.serialize_url_param(
                    "resourceGroupName", self.ctx.args.resource_group,
                    required=True,
                ),
                **self.serialize_url_param(
                    "subscriptionId", self.ctx.subscription_id,
                    required=True,
                ),
            }
            return parameters

        @property
        def query_parameters(self):
            parameters = {
                **self.serialize_query_param(
                    "api-version", "2025-09-01",
                    required=True,
                ),
            }
            return parameters

        @property
        def header_parameters(self):
            parameters = {
                **self.serialize_header_param(
                    "Content-Type", "application/json",
                ),
                **self.serialize_header_param(
                    "Accept", "application/json",
                ),
            }
            return parameters

        @property
        def content(self):
            _content_value, _builder = self.new_content_builder(
                self.ctx.args,
                typ=AAZObjectType,
                typ_kwargs={"flags": {"required": True, "client_flatten": True}}
            )
            _builder.set_prop("location", AAZStrType, ".location", typ_kwargs={"flags": {"required": True}})
            _builder.set_prop("properties", AAZObjectType, typ_kwargs={"flags": {"client_flatten": True}})
            _builder.set_prop("tags", AAZDictType, ".tags")
            _builder.set_prop("zones", AAZListType, ".zones")

            properties = _builder.get(".properties")
            if properties is not None:
                properties.set_prop("adminPassword", AAZStrType, ".admin_password", typ_kwargs={"flags": {"secret": True}})
                properties.set_prop("clusterName", AAZStrType, ".cluster_name")
                properties.set_prop("computeCount", AAZIntType, ".compute_count")
                properties.set_prop("computeModel", AAZStrType, ".compute_model")
                properties.set_prop("databaseEdition", AAZStrType, ".database_edition", typ_kwargs={"flags": {"required": True}})
                properties.set_prop("dbSystemOptions", AAZObjectType, ".db_system_options")
                properties.set_prop("dbVersion", AAZStrType, ".db_version", typ_kwargs={"flags": {"required": True}})
                properties.set_prop("diskRedundancy", AAZStrType, ".disk_redundancy")
                properties.set_prop("displayName", AAZStrType, ".display_name")
                properties.set_prop("domain", AAZStrType, ".domain")
                properties.set_prop("hostname", AAZStrType, ".hostname", typ_kwargs={"flags": {"required": True}})
                properties.set_prop("initialDataStorageSizeInGb", AAZIntType, ".initial_data_storage_size_in_gb")
                properties.set_prop("licenseModel", AAZStrType, ".license_model")
                properties.set_prop("networkAnchorId", AAZStrType, ".network_anchor_id", typ_kwargs={"flags": {"required": True}})
                properties.set_prop("nodeCount", AAZIntType, ".node_count")
                properties.set_prop("pdbName", AAZStrType, ".pdb_name")
                properties.set_prop("resourceAnchorId", AAZStrType, ".resource_anchor_id", typ_kwargs={"flags": {"required": True}})
                properties.set_prop("shape", AAZStrType, ".shape", typ_kwargs={"flags": {"required": True}})
                properties.set_const("source", "None", AAZStrType, ".", typ_kwargs={"flags": {"required": True}})
                properties.set_prop("sshPublicKeys", AAZListType, ".ssh_public_keys", typ_kwargs={"flags": {"required": True}})
                properties.set_prop("storageVolumePerformanceMode", AAZStrType, ".storage_volume_performance_mode")
                properties.set_prop("timeZone", AAZStrType, ".time_zone")

            db_system_options = _builder.get(".properties.dbSystemOptions")
            if db_system_options is not None:
                db_system_options.set_prop("storageManagement", AAZStrType, ".storage_management")

            ssh_public_keys = _builder.get(".properties.sshPublicKeys")
            if ssh_public_keys is not None:
                ssh_public_keys.set_elements(AAZStrType, ".")

            tags = _builder.get(".tags")
            if tags is not None:
                tags.set_elements(AAZStrType, ".")

            zones = _builder.get(".zones")
            if zones is not None:
                zones.set_elements(AAZStrType, ".")

            return self.serialize_content(_content_value)

        def on_200_201(self, session):
            data = self.deserialize_http_content(session)
            self.ctx.set_var(
                "instance",
                data,
                schema_builder=self._build_schema_on_200_201
            )

        _schema_on_200_201 = None

        @classmethod
        def _build_schema_on_200_201(cls):
            if cls._schema_on_200_201 is not None:
                return cls._schema_on_200_201

            cls._schema_on_200_201 = AAZObjectType()

            _schema_on_200_201 = cls._schema_on_200_201
            _schema_on_200_201.id = AAZStrType(
                flags={"read_only": True},
            )
            _schema_on_200_201.location = AAZStrType(
                flags={"required": True},
            )
            _schema_on_200_201.name = AAZStrType(
                flags={"read_only": True},
            )
            _schema_on_200_201.properties = AAZObjectType(
                flags={"client_flatten": True},
            )
            _schema_on_200_201.system_data = AAZObjectType(
                serialized_name="systemData",
                flags={"read_only": True},
            )
            _schema_on_200_201.tags = AAZDictType()
            _schema_on_200_201.type = AAZStrType(
                flags={"read_only": True},
            )
            _schema_on_200_201.zones = AAZListType()

            properties = cls._schema_on_200_201.properties
            properties.cluster_name = AAZStrType(
                serialized_name="clusterName",
            )
            properties.compute_count = AAZIntType(
                serialized_name="computeCount",
            )
            properties.compute_model = AAZStrType(
                serialized_name="computeModel",
            )
            properties.data_storage_size_in_gbs = AAZIntType(
                serialized_name="dataStorageSizeInGbs",
                flags={"read_only": True},
            )
            properties.database_edition = AAZStrType(
                serialized_name="databaseEdition",
                flags={"required": True},
            )
            properties.db_system_options = AAZObjectType(
                serialized_name="dbSystemOptions",
            )
            properties.db_version = AAZStrType(
                serialized_name="dbVersion",
                flags={"required": True},
            )
            properties.disk_redundancy = AAZStrType(
                serialized_name="diskRedundancy",
            )
            properties.display_name = AAZStrType(
                serialized_name="displayName",
            )
            properties.domain = AAZStrType()
            properties.grid_image_ocid = AAZStrType(
                serialized_name="gridImageOcid",
            )
            properties.hostname = AAZStrType(
                flags={"required": True},
            )
            properties.license_model = AAZStrType(
                serialized_name="licenseModel",
            )
            properties.lifecycle_details = AAZStrType(
                serialized_name="lifecycleDetails",
                flags={"read_only": True},
            )
            properties.lifecycle_state = AAZStrType(
                serialized_name="lifecycleState",
                flags={"read_only": True},
            )
            properties.listener_port = AAZIntType(
                serialized_name="listenerPort",
                flags={"read_only": True},
            )
            properties.memory_size_in_gbs = AAZIntType(
                serialized_name="memorySizeInGbs",
                flags={"read_only": True},
            )
            properties.network_anchor_id = AAZStrType(
                serialized_name="networkAnchorId",
                flags={"required": True},
            )
            properties.node_count = AAZIntType(
                serialized_name="nodeCount",
            )
            properties.oci_url = AAZStrType(
                serialized_name="ociUrl",
                flags={"read_only": True},
            )
            properties.ocid = AAZStrType(
                flags={"read_only": True},
            )
            properties.provisioning_state = AAZStrType(
                serialized_name="provisioningState",
                flags={"read_only": True},
            )
            properties.resource_anchor_id = AAZStrType(
                serialized_name="resourceAnchorId",
                flags={"required": True},
            )
            properties.scan_dns_name = AAZStrType(
                serialized_name="scanDnsName",
                flags={"read_only": True},
            )
            properties.scan_ips = AAZListType(
                serialized_name="scanIps",
                flags={"read_only": True},
            )
            properties.shape = AAZStrType(
                flags={"required": True},
            )
            properties.source = AAZStrType(
                flags={"required": True},
            )
            properties.ssh_public_keys = AAZListType(
                serialized_name="sshPublicKeys",
                flags={"required": True},
            )
            properties.storage_volume_performance_mode = AAZStrType(
                serialized_name="storageVolumePerformanceMode",
            )
            properties.time_zone = AAZStrType(
                serialized_name="timeZone",
            )
            properties.version = AAZStrType(
                flags={"read_only": True},
            )

            db_system_options = cls._schema_on_200_201.properties.db_system_options
            db_system_options.storage_management = AAZStrType(
                serialized_name="storageManagement",
            )

            scan_ips = cls._schema_on_200_201.properties.scan_ips
            scan_ips.Element = AAZStrType()

            ssh_public_keys = cls._schema_on_200_201.properties.ssh_public_keys
            ssh_public_keys.Element = AAZStrType()

            system_data = cls._schema_on_200_201.system_data
            system_data.created_at = AAZStrType(
                serialized_name="createdAt",
            )
            system_data.created_by = AAZStrType(
                serialized_name="createdBy",
            )
            system_data.created_by_type = AAZStrType(
                serialized_name="createdByType",
            )
            system_data.last_modified_at = AAZStrType(
                serialized_name="lastModifiedAt",
            )
            system_data.last_modified_by = AAZStrType(
                serialized_name="lastModifiedBy",
            )
            system_data.last_modified_by_type = AAZStrType(
                serialized_name="lastModifiedByType",
            )

            tags = cls._schema_on_200_201.tags
            tags.Element = AAZStrType()

            zones = cls._schema_on_200_201.zones
            zones.Element = AAZStrType()

            return cls._schema_on_200_201


class _CreateHelper:
    """Helper class for Create"""


__all__ = ["Create"]
