# pylint: disable=too-many-lines,too-many-statements
# coding=utf-8
# --------------------------------------------------------------------------
# Copyright (c) Microsoft Corporation. All rights reserved.
# Licensed under the MIT License. See License.txt in the project root for license information.
# Code generated by Microsoft (R) AutoRest Code Generator.
# Changes may cause incorrect behavior and will be lost if the code is regenerated.
# --------------------------------------------------------------------------
from typing import Any, Callable, Dict, Optional, TypeVar
from msrest import Serializer

from azure.core.exceptions import (
    ClientAuthenticationError,
    ResourceExistsError,
    ResourceNotFoundError,
    ResourceNotModifiedError,
)

from azure.core.pipeline import PipelineResponse
from azure.core.pipeline.transport import HttpResponse
from azure.core.rest import HttpRequest
from azure.core.utils import case_insensitive_dict
from ._utils import do_request
from ._extension_operations import get_extension_access_token_async

T = TypeVar("T")
ClsType = Optional[Callable[[PipelineResponse[HttpRequest, HttpResponse], T, Dict[str, Any]], Any]]

_SERIALIZER = Serializer()
_SERIALIZER.client_side_validation = False

class CameraOperations:
    def __init__(self, *args, **kwargs):
        input_args = list(args)
        self._client = input_args.pop(0) if input_args else kwargs.pop("client")
        self._config = input_args.pop(0) if input_args else kwargs.pop("config")
        self._serialize = input_args.pop(0) if input_args else kwargs.pop("serializer")
        self._deserialize = input_args.pop(0) if input_args else kwargs.pop("deserializer")

    def list_cameras(self, extension: Any, **kwargs: Any):
        error_map = {
            401: ClientAuthenticationError,
            404: ResourceNotFoundError,
            409: ResourceExistsError,
            304: ResourceNotModifiedError,
        }
        error_map.update(kwargs.pop("error_map", {}) or {})

        _headers = kwargs.pop("headers", {}) or {}
        _params = case_insensitive_dict(kwargs.pop("params", {}) or {})
        verify_ssl = kwargs.pop("verify_ssl", False)

        extension_id = extension.get('id')
        configuration = extension.get('properties').get('configurationSettings')
        account_id = configuration.get('videoIndexer.accountId')
        account_resource_id = configuration.get('videoIndexer.accountResourceId')
        base_extension_url = configuration.get('videoIndexer.endpointUri')
        extension_url = f"{base_extension_url}/Accounts/{account_id}"
        parts = account_resource_id.strip("/").split("/")
        account_rg = parts[3]
        account_name = parts[-1]

        token = get_extension_access_token_async(
            client=self._client,
            serializer=self._serialize,
            subscription_id=self._config.subscription_id,
            extension_id=extension_id,
            account_name=account_name,
            account_rg=account_rg,
            error_map=error_map,
            headers=_headers,
            params=_params)

        url = f"{extension_url}/cameras"
        response = do_request("GET", url=url, token=token, verify_ssl=verify_ssl)
        return response
