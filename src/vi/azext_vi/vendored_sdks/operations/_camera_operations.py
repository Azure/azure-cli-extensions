# pylint: disable=too-many-lines,too-many-statements
# coding=utf-8
# --------------------------------------------------------------------------
# Copyright (c) Microsoft Corporation. All rights reserved.
# Licensed under the MIT License. See License.txt in the project root for license information.
# Code generated by Microsoft (R) AutoRest Code Generator.
# Changes may cause incorrect behavior and will be lost if the code is regenerated.
# --------------------------------------------------------------------------
from typing import Any
from msrest import Serializer
from azure.core.exceptions import (
    ClientAuthenticationError,
    ResourceExistsError,
    ResourceNotFoundError,
    ResourceNotModifiedError,
)
from azure.core.utils import case_insensitive_dict
from ._utils import do_request
from ._extension_utils import (
    get_extension_access_token_async,
    extract_extension_info
)

_SERIALIZER = Serializer()
_SERIALIZER.client_side_validation = False

class CameraOperations:
    def __init__(self, *args, **kwargs):
        input_args = list(args)
        self._client = input_args.pop(0) if input_args else kwargs.pop("client")
        self._config = input_args.pop(0) if input_args else kwargs.pop("config")
        self._serialize = input_args.pop(0) if input_args else kwargs.pop("serializer")
        self._deserialize = input_args.pop(0) if input_args else kwargs.pop("deserializer")

    def add_camera(self, extension: Any, camera_name: str, rtsp_url: str, **kwargs: Any):
        error_map = {
            401: ClientAuthenticationError,
            404: ResourceNotFoundError,
            409: ResourceExistsError,
            304: ResourceNotModifiedError,
        }
        error_map.update(kwargs.pop("error_map", {}) or {})

        _headers = kwargs.pop("headers", {}) or {}
        _params = case_insensitive_dict(kwargs.pop("params", {}) or {})
        ignore_certificate = kwargs.pop("ignore_certificate", False)

        extension_id, account_name, account_rg, extension_url = extract_extension_info(extension)

        token = get_extension_access_token_async(
            client=self._client,
            serializer=self._serialize,
            subscription_id=self._config.subscription_id,
            extension_id=extension_id,
            account_name=account_name,
            account_rg=account_rg,
            error_map=error_map,
            headers=_headers,
            params=_params)

        url = f"{extension_url}/cameras"
        camera = {
            "Name": camera_name,
            "Description": camera_name,
            "RtspUrl": rtsp_url,
            "LiveStreamingEnabled": True,
            "RecordingEnabled": True,
            "IsPinned": True,
            "RecordingsRetentionInHours": 72,
        }
        response = do_request("POST", url=url, json=camera, token=token, ignore_certificate=ignore_certificate)
        return response

    def list_cameras(self, extension: Any, **kwargs: Any):
        error_map = {
            401: ClientAuthenticationError,
            404: ResourceNotFoundError,
            409: ResourceExistsError,
            304: ResourceNotModifiedError,
        }
        error_map.update(kwargs.pop("error_map", {}) or {})

        _headers = kwargs.pop("headers", {}) or {}
        _params = case_insensitive_dict(kwargs.pop("params", {}) or {})
        ignore_certificate = kwargs.pop("ignore_certificate", False)

        extension_id, account_name, account_rg, extension_url = extract_extension_info(extension)

        token = get_extension_access_token_async(
            client=self._client,
            serializer=self._serialize,
            subscription_id=self._config.subscription_id,
            extension_id=extension_id,
            account_name=account_name,
            account_rg=account_rg,
            error_map=error_map,
            headers=_headers,
            params=_params)

        url = f"{extension_url}/cameras"
        response = do_request("GET", url=url, token=token, ignore_certificate=ignore_certificate)
        return response
