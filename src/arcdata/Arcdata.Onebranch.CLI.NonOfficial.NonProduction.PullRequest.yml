# CLI - PR pipeline
trigger:
  batch: true
  branches:
    include:
    - master
  paths:
    include:
    - projects/azure-cli-extension/*
variables:
- name: Build.SourcesCliDirectory
  value: '$(Build.SourcesDirectory)/projects/azure-cli-extension'
- name: PIPELINE_BUILD_NUMBER
  value: $(Build.BuildNumber)
- name: SOURCE_BRANCH
  value: $(Build.SourceBranch)
- name: LinuxContainerImage
  value: onebranch.azurecr.io/linux/ubuntu-2204:latest
- name: WindowsContainerImage
  value: onebranch.azurecr.io/windows/ltsc2019/vse2022:latest
resources:
  repositories: 
    - repository: templates
      type: git
      name: OneBranch.Pipelines/GovernedTemplates
      ref: refs/heads/main
extends:
  template: v2/OneBranch.NonOfficial.CrossPlat.yml@templates # https://aka.ms/obpipelines/templates
  parameters:
    customTags: 'ES365AIMigrationTooling-BulkMigrated'
    globalSdl: # https://aka.ms/obpipelines/sdl
      asyncSdl: # https://aka.ms/obpipelines/asyncsdl
        enabled: false #
      tsa:
        enabled: false # onebranch publish all sdl results to TSA. If TSA is disabled all SDL tools will forced into 'break' build mode.
      credscan:
        suppressionsFile: $(Build.SourcesDirectory)\.config\CredScanSuppressions.json
      binskim:
        break: true # always break the build on binskim issues in addition to TSA upload
      policheck:
        break: true # always break the build on policheck issues. You can disable it by setting to 'false'
      codeql:
        compiled:
          enabled: false
      # suppression:
      #   suppressionFile: $(Build.SourcesDirectory)\.gdn\global.gdnsuppress
    stages:
    - template: /projects/azure-cli-extension/scripts/ci/pipeline-templates/build.yaml@self
    - template: /projects/azure-cli-extension/scripts/ci/pipeline-templates/coverage.yaml@self
    - template: /projects/azure-cli-extension/scripts/ci/pipeline-templates/lint-and-style.yaml@self
    - template: /projects/azure-cli-extension/scripts/ci/pipeline-templates/test.yaml@self