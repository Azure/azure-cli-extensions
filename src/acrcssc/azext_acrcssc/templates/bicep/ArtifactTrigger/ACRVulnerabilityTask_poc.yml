version: v1.1.0
steps:
  # Task1. Perform the vulnerability scan for the input image
  - cmd: |
      ghcr.io/aquasecurity/trivy image \
      {{.Run.Registry}}/{{.Run.Repository}}:{{.Run.GitTag}} \
      --format sarif \
      --output ./{{.Values.Repository}}_vulnerabilityscan.sarif
  - cmd: |
      ghcr.io/oras-project/oras:v1.1.0 attach \
      --artifact-type application/sarif+json \
      {{.Run.Registry}}/{{.Run.Repository}}:{{.Run.GitTag}} \
      ./{{.Values.Repository}}_vulnerabilityscan.sarif