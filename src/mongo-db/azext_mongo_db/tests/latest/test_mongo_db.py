# --------------------------------------------------------------------------------------------
# Copyright (c) Microsoft Corporation. All rights reserved.
# Licensed under the MIT License. See License.txt in the project root for license information.
#
# Code generated by aaz-dev-tools
# --------------------------------------------------------------------------------------------

from azure.cli.testsdk import (ScenarioTest, ResourceGroupPreparer)
from azure.cli.testsdk.scenario_tests import AllowLargeResponse

class MongoDBScenario(ScenarioTest):
    @AllowLargeResponse(size_kb=10240)
    @ResourceGroupPreparer(name_prefix='cli_test_mongodb', location="eastus2")
    def test_mongo_db(self, resource_group):
        self.kwargs.update({
            'name': 'MongoDBCLITestOrg2',
            'location': 'eastus2',
            'subscription': '00000000-0000-0000-0000-000000000000',
            'marketplace_subscription_id': '00000000-0000-0000-0000-000000000000',
            'publisher_id': 'mongodb',
            'offer_id': 'mongodb_atlas_azure_native_prod',
            'plan_id': 'private_plan',
            'plan_name': 'Pay as You Go (Free) (Private)',
            'term_unit': 'P1M',
            'term_id': 'gmz7xq9ge3py',
            'user_first_name': 'dummy',
            'user_last_name': 'dummy',
            'user_email': 'test@example.com',
            'organization-name': 'MongoDBCLITestOrg2',
            'resource_group': 'cli-test-rg'
        })

        # Create MongoDB Atlas Organization
        self.cmd(
            'az mongo-db atlas organization create --resource-group {resource_group} --name {name} --location {location} --subscription {subscription} '
            '--marketplace \'{{"subscription-id": "{marketplace_subscription_id}", '
            '"offer-details": {{"publisher-id": "{publisher_id}", "offer-id": "{offer_id}", "plan-id": "{plan_id}", "plan-name": "{plan_name}", "term-unit": "{term_unit}", "term-id": "{term_id}"}}}}\' '
            '--user \'{{"first-name": "{user_first_name}", "last-name": "{user_last_name}", "email-address": "{user_email}"}}\' '
            '--partner-properties \'{{"organization-name": "{organization-name}"}}\' ',
            checks=[
                self.check('name', '{name}'),
            ]
        )

        # List MongoDB Atlas Organizations
        self.cmd('az mongo-db atlas organization list --subscription {subscription} --resource-group {resource_group}',
                 checks=[])

        # Show MongoDB Atlas Organization
        self.cmd('az mongo-db atlas organization show --subscription {subscription} --resource-group {resource_group} --name {name}',
                 checks=[
                     self.check('name', '{name}'),
                 ])
        
        # Delete MongoDB Atlas Organization
        self.cmd('az mongo-db atlas organization delete --subscription {subscription} --resource-group {resource_group} --name {name} --yes',
                 checks=[])